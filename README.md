# KG-CLDDI

## Overview

This repository contains source code for our paper "A knowledge graph-based method for drug-drug interaction prediction with contrastive learning".

We design a multi-stage feature extraction process that adeptly extracts drug-related features from the knowledge graph and construct the contrastive learning module using a multi-modal data augmentation strategy to generate high-quality embeddings for drug-drug pairs. 

## Requirements

* Python == 3.7.3
* Pytorch == 1.8.1
* CUDA == 11.1
* pandas == 1.3.0
* scikit-learn == 0.23.2
  
## Pretrain your data Preparation

For multi-class DDI prediction, the multi-class dataset is constructed by Chen et al. (Chen, Y., Ma, T., Yang, X., Wang, J., Song, B., and Zeng, X. (2021). Muffin: multi-scale feature fusion for drug–drug interaction prediction. Bioinformatics, 37(17), 2651–2658), encompassing 1,569 drugs, 172,426 DDIs, and spanning 81 interaction types. the multi-class dataset is in the ./data/Drugbank folder. The details are as follows:
* multi_ddi_sift.txt：The total multi-class dataset.
* MUltiClass_TrainAll_S1.csv: The training dataset of the S1 partition Scheme.
* MUltiClass_Test_S1.csv: The test set of the S1 partition Scheme.
* MUltiClass_Train_S1.csv: The training dataset of the S2 partition Scheme.
* MUltiClass_Test_S2.csv: The test set of the S2 partition Scheme.
  
 For multi-label DDI prediction, we construct our multi-label dataset using the TWOSIDES database. In line with prior studies (Zitnik, M., Agrawal, M., and Leskovec, J. (2018). Modeling polypharmacy side
effects with graph convolutional networks. Bioinformatics, 34(13), i457–i466; Dai, Y., Guo, C., Guo, W., and Eickhoff, C. (2021). Drug–drug interaction prediction with wasserstein adversarial autoencoder-based knowledge graph embeddings. Briefings in bioinformatics, 22(4), bbaa256), we focus on retaining 200 frequently encountered DDI types. This selection criteria ensures that each DDI type within the dataset encompasses no fewer than 13,000 distinct drug combinations. To map drugs into the KG dataset, we collect 1,276 drugs, 98,327 DDIs, and spanning 200 interaction types.the multi-class dataset is in the ./data/TwoSides folder, and needs to unzip the compressed files. The details are as follows:
* TWOSIDES_refine_Multilabels_top600.rar: The total multi-label data.
* Inductive setting.rar: The training and test datasets for the S1 and S2 partition schemes.

In addition, for both multi-class and multi-label prediction, the knowledge graph dataset and the initial embedding data generated by pre-training are placed in the ./data/TwoSides folder.  We construct the  knowledge graph dataset by sourcing data from the DRKG. To ensure no information leakage, we remove all the relation types are defined as <DRUGBANK::DDI-interactor-in::Compound:Compound> in the DRKG. The rest triplets are treated as our KG dataset, which comprises 96,766 entities and 4,488,504 triplets.The details are as follows:
* DRKG_TransE_l2_entity.rar:Entity embeddings of the knowledge graph generated in the Pre-training stage.
* DRKG_TransE_l2_relation.npy:Relationship embeddings of the knowledge graph generated in the Pre-training stage.
* kg.rar: The knowledge graph dataset.
  
## Files:

For multi-label DDI prediction, the files are in the ./multilabel folder; for multi-class DDI prediction, the files are in the ./multiclass folder. The details are as follows:
* GAT.py: The implementation of attention-based knowledge aggregation mechanism for generating the knowledge aggregation embeddings.
* Procedure.py: The implementation of the contrastive learning moudule, model training and testing process.
* dataloader.py: Knowledge graph, training and test data sets are loaded and parsed, and a drug-drug bipartite graph is constructed.
* model.py: The implementation of the lightGCN and task classifier.
* register.py: The parameter settings for dataset and model loading.
* world.py: The parameter settings for the lightGCN.
* parse.py: The parameter settings for the KG-CLDDI.
* main.py: The implementation for running our code.
  
## Running the code

For multi-label DDI prediction, you should go into the ./multilabel folder; for multi-class DDI prediction, you should go into the ./multiclass folder. The parameters are already set in the code files. You can run the following command to re-implement our work:

* > python main.py

## Contact

If you have any questions or suggestions with the code, please let us know. Contact Zhong Jian at jianzhong@csu.edu.cn
